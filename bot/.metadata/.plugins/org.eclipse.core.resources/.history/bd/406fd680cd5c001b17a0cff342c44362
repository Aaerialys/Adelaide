package bot;

import java.io.File;
import java.io.FileNotFoundException;
import java.io.FileOutputStream;
import java.io.PrintStream;
import java.util.Timer;
import java.util.TimerTask;

import org.javacord.api.DiscordApi;
import org.javacord.api.DiscordApiBuilder;
import org.javacord.api.entity.intent.Intent;

public class Main {
    private static BotListener bot;
    private static class SaveState extends TimerTask { //saves information on the bots
        public void run() {
            bot.save();
        }
    }
    public static void main(String[] args) {
    	PrintStream out;
		try { //sets output stream to a log file
			out = new PrintStream(new FileOutputStream(new File("log.txt")));
	    	System.setErr(out);
	    	System.setOut(out);
		} catch (FileNotFoundException e) {
			System.err.println("Log file not found");
			e.printStackTrace();
		}
        DiscordApi api = new DiscordApiBuilder().setToken("Nzk5NDc3OTQ1MjE1MDkwNjg4.YAEJ2w.Rf1gAsGvWNbagEmZmLBswe6Bg5I") //connects bot to discord api
            .setAllIntentsExcept(Intent.GUILD_PRESENCES).login().join();
        bot = new BotListener(api);
        api.addListener(bot); //allows the bot to respond to messages
        DmojCfApi.updateCache();
        api.getOwner().join().sendMessage("Starting the bot");
        System.out.println("Bot started");
        Timer timer = new Timer();
        timer.schedule(new SaveState(), 0, 120000);
    }
}